<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©å ‚M åœ°é¾å–®æŒ‘çµ‚æ¥µåˆ†æå„€ (Fixed)</title>

    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 1. å¼•å…¥ React ç›¸é—œä¾è³´ (ä½¿ç”¨ 16.14.0 ç©©å®šç‰ˆ - ç”¨æ–¼ç›¸å®¹èˆŠç‰ˆ Recharts) -->
    <script crossorigin src="https://unpkg.com/react@16.14.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16.14.0/umd/react-dom.production.min.js"></script>

    <!-- 2. å¼•å…¥ Recharts ä¾è³´ (Prop-types) -->
    <script src="https://unpkg.com/prop-types@15.7.2/prop-types.min.js"></script>

    <!-- 3. å¼•å…¥ Recharts (ä½¿ç”¨ 1.8.5 ç©©å®šç‰ˆ - UMD æ”¯æ´æœ€å¥½) -->
    <script src="https://unpkg.com/recharts@1.8.5/umd/Recharts.min.js"></script>

    <!-- 4. å¼•å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #0f172a;
            /* slate-950 */
            color: #e2e8f0;
            /* slate-200 */
            font-family: system-ui, -apple-system, sans-serif;
        }

        .recharts-wrapper {
            user-select: none;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BS3MLPQBVB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-BS3MLPQBVB');
</script>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        // å¾ window ç‰©ä»¶å®‰å…¨è§£æ§‹ Recharts çµ„ä»¶
        const RechartsObj = window.Recharts;
        if (!RechartsObj) {
            console.error("Recharts library not found! window.Recharts is undefined.");
            // Render an error message to the screen
            const root = document.getElementById('root');
            if (root) root.innerHTML = '<div style="color: #ef4444; padding: 20px; text-align: center;"><h1>Library Error</h1><p>Recharts failed to load. Please check your internet connection.</p></div>';
            throw new Error("Recharts not found");
        }

        const {
            ScatterChart, Scatter, XAxis, YAxis, CartesianGrid, Tooltip,
            ResponsiveContainer, ReferenceArea, Legend, Line, ComposedChart, ReferenceLine
        } = RechartsObj;

        // --- ç·šæ€§è¿´æ­¸è¨ˆç®—å‡½æ•¸ ---
        const calculateLinearRegression = (data, xKey = 'damage', yKey = 'time') => {
            if (data.length < 2) return null;

            const n = data.length;
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;

            data.forEach(d => {
                const x = d[xKey];
                const y = d[yKey];
                sumX += x;
                sumY += y;
                sumXY += x * y;
                sumX2 += x * x;
            });

            const denominator = (n * sumX2 - sumX * sumX);
            if (denominator === 0) return null; // é˜²æ­¢å‚ç›´ç·šå°è‡´çš„é™¤ä»¥é›¶

            const slope = (n * sumXY - sumX * sumY) / denominator;
            const intercept = (sumY - slope * sumX) / n;

            // è¨ˆç®— RÂ² (æ±ºå®šä¿‚æ•¸)
            const yMean = sumY / n;
            let ssTotal = 0, ssResidual = 0;
            data.forEach(d => {
                const y = d[yKey];
                const yPredicted = slope * d[xKey] + intercept;
                ssTotal += Math.pow(y - yMean, 2);
                ssResidual += Math.pow(y - yPredicted, 2);
            });

            // å¦‚æœ ssTotal ç‚º 0ï¼Œä»£è¡¨æ‰€æœ‰ Y å€¼(æ™‚é–“)ç›¸ç­‰
            // è‹¥å›æ­¸é æ¸¬ä¹Ÿå®Œå…¨ç²¾æº–(ssResidual=0)å‰‡ R2 ç‚º 1ï¼Œå¦å‰‡ç‚º 0
            const rSquared = ssTotal === 0 ? (ssResidual === 0 ? 1 : 0) : 1 - (ssResidual / ssTotal);

            // è¨ˆç®—è¶¨å‹¢ç·šçš„èµ·é»å’Œçµ‚é»
            const xValues = data.map(d => d[xKey]);
            const minX = Math.min(...xValues);
            const maxX = Math.max(...xValues);

            return {
                slope,
                intercept,
                rSquared: Math.max(0, Math.min(1, rSquared)), // å¼·åˆ¶é™åˆ¶åœ¨ 0~1 å€é–“
                startPoint: { x: minX, y: slope * minX + intercept },
                endPoint: { x: maxX, y: slope * maxX + intercept },
                // æ€§åƒ¹æ¯”æŒ‡æ¨™ï¼šæ–œç‡è¶Šè²  = å‚·å®³è½‰æ›æ•ˆç‡è¶Šé«˜
                efficiency: -slope * 100 // æ¯100é»å‚·å®³æ¸›å°‘çš„æ™‚é–“ï¼ˆåˆ†é˜ï¼‰
            };
        };

        // è¨ˆç®—æ‰€æœ‰è·æ¥­çš„è¶¨å‹¢ç·šæ•¸æ“š
        const calculateAllTrendLines = () => {
            const trendData = {};
            ALL_CLASSES.forEach(job => {
                const jobData = FULL_DATA.filter(d => d.class === job && d.time > 0);
                if (jobData.length >= 2) {
                    trendData[job] = calculateLinearRegression(jobData);
                }
            });
            return trendData;
        };

        // è¨ˆç®—æ³•å¸«å°ˆç”¨è¶¨å‹¢ç·šï¼ˆæ™‚é–“ç‚ºXè»¸ï¼Œå‚·å®³/SPç‚ºYè»¸ï¼‰
        const calculateMageTrendLines = () => {
            const mageData = FULL_DATA.filter(d => d.class === 'æ³•å¸«' && d.time > 0);
            if (mageData.length < 2) return null;

            // å‚·å®³ vs æ™‚é–“è¶¨å‹¢ç·šï¼ˆX=æ™‚é–“, Y=å‚·å®³ï¼‰
            const damageTrend = calculateLinearRegression(mageData, 'time', 'damage');

            // SP vs æ™‚é–“è¶¨å‹¢ç·šï¼ˆX=æ™‚é–“, Y=SPï¼‰
            const spData = mageData.filter(d => d.sp);
            const spTrend = spData.length >= 2 ? calculateLinearRegression(spData, 'time', 'sp') : null;

            return { damageTrend, spTrend };
        };

        // --- 1. å…§å»º SVG åœ–ç¤ºå…ƒä»¶ ---
        const Icon = ({ children, className = "", size = 20, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );

        const TrophyIcon = (p) => <Icon {...p}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" /><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" /><path d="M4 22h16" /><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" /><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" /><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" /></Icon>;
        const UsersIcon = (p) => <Icon {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></Icon>;
        const ZapIcon = (p) => <Icon {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></Icon>;
        const TargetIcon = (p) => <Icon {...p}><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></Icon>;
        const AlertIcon = (p) => <Icon {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><path d="M12 9v4" /><path d="M12 17h.01" /></Icon>;
        const InfoIcon = (p) => <Icon {...p}><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></Icon>;
        const TrendingUpIcon = (p) => <Icon {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></Icon>;
        const ResetIcon = (p) => <Icon {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></Icon>;
        const MenuIcon = (p) => <Icon {...p}><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></Icon>;
        const CloseIcon = (p) => <Icon {...p}><path d="M18 6 6 18" /><path d="m6 6 12 12" /></Icon>;
        const ShieldIcon = (p) => <Icon {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /></Icon>;
        const BackIcon = (p) => <Icon {...p}><path d="m15 18-6-6 6-6" /></Icon>;
        const SwordIcon = (p) => <Icon {...p}><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5" /><line x1="13" y1="19" x2="19" y2="13" /><line x1="16" y1="16" x2="20" y2="20" /><line x1="19" y1="21" x2="21" y2="19" /></Icon>;
        const ActivityIcon = (p) => <Icon {...p}><path d="M22 12h-4l-3 9L9 3l-3 9H2" /></Icon>;
        const SearchIcon = (p) => <Icon {...p}><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></Icon>;
        const ExternalLinkIcon = (p) => <Icon {...p}><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" /><polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" /></Icon>;

        // --- 2. å®Œæ•´ 98 ç­†æ•¸æ“šå°å…¥ ---
        const CSV_DATA = `
é­”åŠå£«,88,é‡‘è®Šè¦ºé†’,260,ç´”ç™½æŠ€,55,
é­”åŠå£«,91,é‡‘è®Š,254,8ç´…8ç´«,32,
é­”åŠå£«,91,é‡‘è®Š,250,å…¨æ»¿,30,
æ§æ‰‹,91,ç´«è®Š,280,ç´…ç´«æ»¿1é‡‘,6,
æ§æ‰‹,91,ç´«è®Š,255,æ»¿æŠ€èƒ½,10,
æ§æ‰‹,87,é‡‘è®Š,250,5ç´…(ç¥å°„æ‰‹+å¿«é€Ÿå°„æ“Š(å£«å…µ)+æ­»ç‹™+ç ´å£å°„æ“Š+é˜²ç¦¦çŒç©¿),30,
æ§æ‰‹,90,é‡‘è®Š,240,æ»¿æŠ€,14,
æ§æ‰‹,91,ç´«è®Š,205,ç´…ç´«æ»¿/ç„¡å•†åŸç´«,17,
æ§æ‰‹,90,ç´«è®Šè¦ºé†’,194,ç¼ºå•†åŸç´«,15,
é›·ç¥,90,é‡‘è®Š(é‡‘è¦ºé†’),196,ç¼ºå•†åŸç´«,30,å‚™è¨»:206å‚·/25åˆ†
é›·ç¥,90,ç´«è®Š,312,6ç´…1ç´«,12,
é›·ç¥,90,ç´«è®Šè¦ºé†’,265,ç´…ç´«æ»¿/ç„¡å•†åŸç´«,10,
é›·ç¥,90,é‡‘è®Š,253,4ç´…æŠ€,20,
é›·ç¥,91,é‡‘è®Šè¦ºé†’,242,æ»¿ç´…æ»¿ç´«ï¼Œç„¡å•†åŸç´«/ç„¡è¡€ç›Ÿç´«,20,
é›·ç¥,90,ç´«è®Š(é‡‘è®Š),240,æœ‰è¡€ç›Ÿç´«,20,å‚™è¨»:15åˆ†
é›·ç¥,90,ç´«è®Š,225,æœ‰è¡€ç›Ÿç´«,25,
é›·ç¥,90,ç´«è®Šè¦ºé†’,257,PVEæŠ€èƒ½å…¨æ»¿/ç„¡å•†åŸç´«/ç„¡é‡‘,22,
è–åŠ,91,é‡‘è®Š,220,ç´…ç´«æŠ€PVEæ»¿,23,SP 106
é»‘å¦–,91,é‡‘è®Šè¦ºé†’,310,å…¨æ»¿/æœ‰å¤¢é­˜,9,
é»‘å¦–,88,é‡‘è®Š,300,4ç´…æŠ€,0,å¤±æ•—
é»‘å¦–,90,ç´«è®Šè¦ºé†’,220,ç´…ç´«æ»¿/ç„¡å•†åŸç´«/æœ‰å¤¢é­˜,26,
æ³•å¸«,91,ç´«è®Šè¦ºé†’,240,å¤ä»£ç©¶å…‰/ç„¡å•†åŸç´«/å…¨ç¨‹å¬å–š,12,SP 127
ç‹‚æˆ°å£«,90,é‡‘è®Š,321,æ»¿ç´…4ç´«,15,
ç‹‚æˆ°å£«,89,ç´«è®Š,320,6ç´…æŠ€,55,
å¦–ç²¾,91,é‡‘è®Šè¦ºé†’,325,ç´…ç´«æ»¿/æœ‰å•†åŸç´«/æœ‰é›™é‡‘(2é‡‘Lv.1),5,
å¦–ç²¾,91,é‡‘è®Š,320,æ»¿æŠ€,5,
å¦–ç²¾,91,é‡‘è®Šè¦ºé†’,280,å…¨æ»¿,7,
å¦–ç²¾,90,ç´«è®Šè¦ºé†’,250,ç´…ç´«æ»¿/ç„¡å•†åŸç´«/æœ‰ç²¾éˆç‹,20,
å¦–ç²¾,91,ç´«è®Šè¦ºé†’,250,ç´…ç´«æ»¿/ç„¡å•†åŸç´«/æœ‰ç²¾éˆç‹/æœ‰+6é¢¨è€³,10,
æ­»ç¥,91,ç´«è®Š,345,æŠ€èƒ½å…¨æ»¿/æœ‰å•†åŸç´«/,13,
ç‹æ—,89,é‡‘è®Š,300,4ç´…ï¼Œæœ‰å‹‡çŒ›å¤§å¸«,15,
ç‹æ—,88,ç´«è®Š,280,4ç´…ï¼Œæœ‰å‹‡çŒ›å¤§å¸«,25,
ç‹æ—,90,ç´«è®Š,260,æ»¿(ç„¡é›™ç¨ç‰¹ç´«),20,
ç‹æ—,87,é‡‘è®Šè¦ºé†’,258,onlyå‹‡çŒ›å¤§å¸«,25,
ç‹æ—,90,é‡‘è®Š,255,4ç´…ï¼Œæœ‰å‹‡çŒ›å¤§å¸«,13,
ç‹æ—,87,é‡‘è®Šè¦ºé†’,255,onlyå‹‡çŒ›å¤§å¸«,25,
ç‹æ—,89,ç´«è®Šè¦ºé†’,239,1ç´«6ç´…,23,
ç‹æ—,90,ç´«è®Šè¦ºé†’,225,ç´…ç´«PVEæŠ€èƒ½å…¨æ»¿,26,å¤ä»£ç¥ä¹‹çŸ›
æ³•å¸«,91,ç´«è®Š,197,ç´…ç´«æŠ€å…¨æ»¿/æ²’å•†åŸç´«/æ²’æœ‰é‡‘æŠ€,35,SP 140
æ§æ‰‹,88,ç´«è®Š,221,ç´…æ»¿/æº–å‚™é–‹ç«/ç„¡800/ç„¡å•†åŸç´«/æœ‰+5åœ°è€³,20,
é­”åŠå£«,91,ç´«è®Šè¦ºé†’,273,ç´…ç´«æŠ€å…¨æ»¿/ç¼ºå•†åŸç´«/ç¼º1é‡‘/è—æ­¦,45,
æ³•å¸«,90,é‡‘è®Š,187,å¤ä»£ç©¶å…‰/å…¨ç¨‹å¬å–š,27,SP 124
æ³•å¸«,91,ç´«è®Šè¦ºé†’,188,ç´…ç´«æ»¿/2é‡‘/ç„¡å•†åŸç´«/å…¨ç¨‹å¬å–š,17,SP 134
é¾é¬¥,91,ç´«è®Šè¦ºé†’,271,ç´…ç´«æ»¿/ç„¡å•†åŸç´«/é›™é‡‘æŠ€,42,
é­”åŠå£«,88,é‡‘è®Š,260,1ç´…è¶…è²æ³¢,27,
é­”åŠå£«,91,ç´«è®Šè¦ºé†’,275,ç´…ç´«å…¨æ»¿(ç¼ºä¸‰ä½),26,
é¾é¬¥,88,ç´«è®Šè¦ºé†’,257,PVEç´…æ»¿0ç´«,31,7å¼’è¡€è€…(ç²¾å·¥+9 6%)ã€æœ‰æ­»é¨æ‰‹ç’°+3%æ”»æ“Š
é»‘å¦–,90,ç´«è®Šè¦ºé†’,255,ç´…ç´«æŠ€å…¨æ»¿/ç„¡é‡‘æŠ€/æœ‰å•†åŸç´«/9ç´«æ­¦,15,7ç´«æ­¦æ‰“28åˆ†é˜ï¼Œæ­¦å™¨å½±éŸ¿å¤§
ç‹æ—,89,é‡‘è®Šè¦ºé†’,225,æ»¿ç´…/é¢¨å±¬æ€§å–®æ‰‹åŠ,27,
ç‹‚æˆ°å£«,90,ç´«è®Š,241,ç´…ç´«æ»¿/ç¼ºå•†åŸç´«,20,
æ§æ‰‹,90,é‡‘è®Šè¦ºé†’,240,ç´…ç´«æŠ€å…¨æ»¿/æœ‰æº–å‚™é–‹ç«/é‡‘æŠ€:å’Œå¹³ä½¿è€…,11,ç´…æŠ€ï¼šæ­»ç‹™ã€ç©¿ç”²å½ˆã€å¿«é€Ÿå°„æ“Š(å£«å…µ)ã€ç¥å°„æ‰‹
é¨å£«,91,é‡‘è®Šè¦ºé†’,230,ç´…ç´«æ»¿/ç¼ºå•†åŸç´«/2é‡‘æŠ€,27,æ–°ç¯‡ç« 
é­”åŠå£«,90,ç´«è®Šè¦ºé†’,265,ç´…ç´«æ»¿(ç¼ºä¸‰ä½2æ‹›),27,9ä¸‰éšç´«æ­¦(ç²¾å·¥+8æ”» +15%å±¬çˆ†)ï¼Œé¢¨é¾æ°´æ™¶
è–åŠ,91,ç´«è®Š,221,ç´…ç´«æ»¿/ç¼ºå•†åŸç´«/é›™é‡‘æŠ€,25,é¢¨é¾æ°´æ™¶ï¼Œæ’é­”æ³•çˆ†æ“Š
é¨å£«,91,ç´«è®Š,300,æŠ€èƒ½å…¨æ»¿,45,
é¾é¬¥,91,é‡‘è®Šè¦ºé†’,250,æ»¿ç´«ç´…æŠ€/æœ‰å•†åŸç´«/3é‡‘æŠ€,18,
æ³•å¸«,91,é‡‘è®Š,200,ç´…ç´«å…¨æ»¿/ç©¶å…‰å¤ä»£/å…¨ç¨‹å¬å–š/ç¼ºå•†åŸç´«,10,SP 125
æ³•å¸«,91,é‡‘è®Šè¦ºé†’,300,æŠ€èƒ½é™¤æš—é»‘æµæ˜Ÿå…¨æ»¿/æœ‰å•†åŸç´«/ç©¶å…‰å¤ä»£/å…¨ç¨‹å¬å–š,6,SP 156
æ§æ‰‹,90,é‡‘è®Šè¦ºé†’,219,ç´…ç´«æŠ€å…¨æ»¿/æœ‰è¡€ç›Ÿç´«/æ²’å•†åŸç´«/,15,7æ­æ§
é­”åŠå£«,90,é‡‘è®Šè¦ºé†’,238,ç´…ç´«æŠ€æ»¿/ç¼ºå•†åŸç´«/æ²’é‡‘æŠ€,35,
ç‹‚æˆ°å£«,90,ç´«è®Šè¦ºé†’,227,ç´…ç´«æŠ€åªå­¸PVEæŠ€èƒ½/ç¼ºå•†åŸç´«/,55,7ç²¾å·¥ç´«æ–§10æ”»15çˆ†ï¼Œåœ°å±¬
é›·ç¥,91,ç´«è®Šè¦ºé†’,231,æ»¿ç´…æ»¿ç´«æŠ€/2é‡‘æŠ€,22,äºŒéš7ç´«æ­¦
é­”åŠå£«,91,é‡‘è®Š,300,ç´…ç´«æŠ€å…¨æ»¿,28,7ä¸‰éšé¢¨å±¬ç´«æ­¦
é¾é¬¥,91,é‡‘è®Šè¦ºé†’,309,ç´…ç´«æŠ€å…¨æ»¿,9,
é»‘å¦–,91,é‡‘è®Šè¦ºé†’,325,ç´…ç´«æŠ€å…¨æ»¿/æœ‰å¤¢é­˜,8,
è–åŠ,91,é‡‘è®Šè¦ºé†’,277,ç´…ç´«é‡‘æŠ€èƒ½å…¨æ»¿/æœ‰å•†åŸç´«,13,SP 110
è–åŠ,91,é‡‘è®Šè¦ºé†’,314,ç´…ç´«é‡‘æŠ€èƒ½å…¨æ»¿/æœ‰å•†åŸç´«,13,SP 99
ç‹‚æˆ°å£«,86,é’è®Šè¦ºé†’,292,åªæœ‰ç™½æŠ€,25,
æ³•å¸«,91,é‡‘è®Šè¦ºé†’,257,ç”¨æ™®æ”»+å†°åˆºæ”»æ“Š,28,
é¨å£«,91,é‡‘è®Šè¦ºé†’,380,ç´…ç´«æŠ€æ»¿/æœ‰å‚·åŸç´«,13,
æ³•å¸«,91,é‡‘è®Š,226,æ’å¤ä»£ç©¶å…‰/å…¨ç¨‹å¬å–š,13,SP 121
ç‹æ—,86,é‡‘è®Š,220,onlyå‹‡çŒ›å¤§å¸«,26,
é»‘å¦–,90,é‡‘è®Šè¦ºé†’,251,5ç´…2ç´«/1é‡‘æŠ€/æœ‰å¤¢é­˜/ç„¡å•†åŸç´«,39,
é¨å£«,91,é‡‘è®Š,263,ç´…ç´«æŠ€å…¨æ»¿/ç„¡å•†åŸç´«,40,
æš—é¨,81,é‡‘è®Šè¦ºé†’,238,4ç´…æŠ€,45,
é›·ç¥,90,ç´«è®Šè¦ºé†’,228,ç´…ç´«æŠ€èƒ½å…¨æ»¿/æœ‰è¡€ç›Ÿç´«,16,
é›·ç¥,91,é‡‘è®Šè¦ºé†’,236,ç´…ç´«é‡‘æŠ€èƒ½å…¨æ»¿/æœ‰è¡€ç›Ÿç´«/,12,
ç‹æ—,83,é‡‘è®Šè¦ºé†’,221,4ç´…æŠ€,32,
æ§æ‰‹,83,ç´«è®Šè¦ºé†’,234,3ç´…æŠ€,32,ç¥å°„æ‰‹ã€æ­»ç‹™ã€å¿«å°„å£«å…µ
æ³•å¸«,91,é‡‘è®Šè¦ºé†’,247,11ç´…8ç´«/æœ‰å•†åŸç´«/2é‡‘æŠ€/å…¨ç¨‹å¬å–š/ç©¶å…‰å¤ä»£,12,SP 150
é›·ç¥,90,ç´«è®Šè¦ºé†’,212,ç´…ç´«æŠ€èƒ½å…¨æ»¿/æœ‰è¡€ç›Ÿç´«/ç„¡å•†åŸç´«/,30,
ç‹‚æˆ°å£«,91,é‡‘è®Šè¦ºé†’,270,ç´…ç´«æŠ€èƒ½å…¨æ»¿/ç¼ºå•†åŸç´«/ç„¡é‡‘æŠ€,14,9ä¸‰éšçŸ›
ç‹æ—,86,é‡‘è®Šè¦ºé†’,210,4ç´…æŠ€/æœ‰å‹‡çŒ›å¤§å¸«,30,
ç‹æ—,86,ç´«è®Šè¦ºé†’,261,3ç´…æŠ€/æœ‰å‹‡çŒ›å¤§å¸«,53,6é…·å¯’
é›·ç¥,91,é‡‘è®Šè¦ºé†’,290,ç´…ç´«é‡‘æŠ€èƒ½å…¨æ»¿/æœ‰è¡€ç›Ÿç´«/ç„¡å•†åŸç´«/,8,æ³¢è³½é “çŸ›
å¦–ç²¾,91,é‡‘è®Šè¦ºé†’,298,ç´…ç´«æ»¿/æœ‰å•†åŸç´«/æœ‰é›™é‡‘(2é‡‘Lv.1),20,8æ²™å“ˆ
æ³•å¸«,91,é‡‘è®Š,200,7ç´…8ç´«æŠ€/æœ‰å•†åŸç´«/2é‡‘æŠ€/å…¨ç¨‹å¬å–š/ç©¶å…‰å¤ä»£,11,SP 135
é­”åŠå£«,91,é’è®Š,267,ç´…ç´«æŠ€èƒ½å…¨æ»¿/ç„¡å•†åŸç´«,18,7æ­æ­¦
æ³•å¸«,91,é‡‘è®Š,260,ç´…ç´«æŠ€èƒ½å…¨æ»¿/æœ‰å•†åŸç´«/2é‡‘æŠ€/å…¨ç¨‹å¬å–š/ç©¶å…‰å¤ä»£,10,SP 134
ç‹æ—,88,,246,5ç´…æŠ€/ç„¡å•†åŸç´«,35,
é›·ç¥,91,é‡‘è®Šè¦ºé†’,246,ç´…ç´«æŠ€èƒ½å…¨æ»¿/ç¼ºå•†åŸç´«/ç„¡é‡‘æŠ€,11,7æ­çŸ›
é›·ç¥,90,ç´«è®Šè¦ºé†’,260,ç´…æŠ€æ»¿/ç´«æŠ€ç¼ºå¥³æ­¦ç¥/æœ‰è¡€ç›Ÿç´«/æœ‰å•†åŸç´«,21,7å…‹ç‰¹
é­”åŠå£«,90,é‡‘è®Šè¦ºé†’,260,ç´…ç´«æŠ€èƒ½å…¨æ»¿/ç¼ºå•†åŸç´«/2é‡‘æŠ€,26,8ä¸‰éšç´«æ­¦
è–åŠ,91,é’è®Š,300,ç´…ç´«æŠ€èƒ½å…¨æ»¿/ç¼ºå•†åŸç´«/2é‡‘æŠ€,14,7æ­å–®
é›·ç¥,91,é‡‘è®Šè¦ºé†’,288,ç´…ç´«æŠ€èƒ½å…¨æ»¿/æœ‰å•†åŸç´«/æœ‰è¡€ç›Ÿç´«/,6,7æ³¢è³½é “
ç‹æ—,86,ç´«è®Šè¦ºé†’,220,2ç´…æŠ€/æœ‰å‹‡çŒ›å¤§å¸«,30,æ‹¿åº•çŸ­å¢åŠ æ”»é€Ÿ
é›·ç¥,91,é‡‘è®Šè¦ºé†’,240,ç´…ç´«æŠ€èƒ½å…¨æ»¿/2é‡‘æŠ€/ç¼ºå•†åŸç´«,12,ç”¨7åœ°å±¬æ€§æƒ¡é­”ç‹çŸ›å‚·(12å‚·15%çˆ†)
é­”åŠå£«,90,ç´«è®Šè¦ºé†’,317,ç´…ç´«æŠ€èƒ½å…¨æ»¿/ç„¡å•†åŸç´«/2é‡‘æŠ€,21,
é»‘å¦–,90,é‡‘è®Šè¦ºé†’,263,5ç´…2ç´«/1é‡‘æŠ€/æœ‰å¤¢é­˜/ç„¡å•†åŸç´«,28,
æ§æ‰‹,89,é‡‘è®Šè¦ºé†’,220,4ç´«8ç´…æŠ€/æœ‰è¡€ç›Ÿç´«/ç„¡å•†åŸç´«,14,7æ­ç ² (åœ°å±¬8å‚· 8%çˆ†),
`;

        const COLORS = {
            'æ§æ‰‹': '#F59E0B', 'é›·ç¥': '#3B82F6', 'æ³•å¸«': '#8B5CF6', 'é»‘å¦–': '#10B981', 'ç‹æ—': '#EF4444',
            'é­”åŠå£«': '#EC4899', 'ç‹‚æˆ°å£«': '#9CA3AF', 'å¦–ç²¾': '#A3E635', 'æ­»ç¥': '#F3F4F6', 'é¾é¬¥': '#F97316',
            'è–åŠ': '#06B6D4', 'é¨å£«': '#64748B', 'æš—é¨': '#1e293b'
        };

        const ALL_CLASSES = Object.keys(COLORS);

        // è§£æ CSV
        const parseAndProcessData = (csv) => {
            return csv.trim().split('\n').map((line, idx) => {
                const parts = line.split(',');
                const item = {
                    id: idx + 1,
                    class: parts[0],
                    level: parseInt(parts[1]) || 0,
                    trans: parts[2],
                    damage: parseInt(parts[3]) || 0,
                    skill: parts[4],
                    time: parseInt(parts[5]) || 0,
                    note: parts[6] || ""
                };

                const noteSP = item.note.match(/SP\s*(\d+)/i);
                const damageSP = line.match(/\(SP\s*(\d+)\)/i);
                item.sp = noteSP ? parseInt(noteSP[1]) : (damageSP ? parseInt(damageSP[1]) : null);

                if (item.time === 0) return { ...item, efficiency: 0 };
                return item;
            });
        };

        const FULL_DATA = parseAndProcessData(CSV_DATA);

        // è‡ªè¨‚åœ–è¡¨å½¢ç‹€
        const CustomShape = (props) => {
            const { cx, cy, fill, payload } = props;
            const isHighTier = payload.trans && (payload.trans.includes('é‡‘') || payload.trans.includes('é’'));

            if (isHighTier) {
                return <path d={`M${cx},${cy - 6} L${cx + 6},${cy + 6} L${cx - 6},${cy + 6} Z`} fill={fill} stroke="#fff" strokeWidth={1} />;
            }
            return <circle cx={cx} cy={cy} r={5} fill={fill} stroke="#fff" strokeWidth={1} />;
        };



        const Overview = ({ onViewClass }) => {
            const [activeJob, setActiveJob] = useState(null);
            const [showTrendLines, setShowTrendLines] = useState(true);
            const [hoverPos, setHoverPos] = useState(null);
            const scalesRef = useRef(null);

            // è¨ˆç®—æ‰€æœ‰è¶¨å‹¢ç·š
            const trendLines = useMemo(() => calculateAllTrendLines(), []);

            // è¨ˆç®—æ³•å¸«å°ˆç”¨è¶¨å‹¢ç·š
            const mageTrendLines = useMemo(() => calculateMageTrendLines(), []);

            // è¨ˆç®—æ•¸æ“šé‚Šç•Œ
            const chartBounds = useMemo(() => {
                const damages = FULL_DATA.map(d => d.damage);
                const times = FULL_DATA.filter(d => d.time > 0).map(d => d.time);
                const sps = FULL_DATA.filter(d => d.sp).map(d => d.sp);

                const xMin = Math.min(...damages) - 20;
                const xMax = Math.max(...damages) + 20;
                const yMax = Math.max(...times) + 5;

                const spMin = sps.length > 0 ? Math.min(...sps) - 10 : 80;
                const spMax = sps.length > 0 ? Math.max(...sps) + 10 : 200;

                return { xMin, xMax, yMax, spMin, spMax };
            }, []);



            const isMageActive = activeJob === 'æ³•å¸«';

            return (
                <div className="space-y-8 animate-fade-in pb-12">
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        {[
                            { name: 'æ§æ‰‹', icon: <TrophyIcon />, color: 'amber', desc: 'CPç‹è€…ï¼š194å‚·æ‰“15åˆ†' },
                            { name: 'ç‹æ—', icon: <UsersIcon />, color: 'red', desc: 'ä½æˆæœ¬ï¼š2ç´…æŠ€ç©©é' },
                            { name: 'å¦–ç²¾', icon: <ZapIcon />, color: 'green', desc: 'æ¥µé€Ÿï¼šé ‚é…5åˆ†é€šé—œ' },
                            { name: 'é›·ç¥', icon: <TargetIcon />, color: 'blue', desc: 'æœ€ç©©å®šï¼šæ¥µé™é©…å‹•è¼¸å‡º' }
                        ].map(item => (
                            <div key={item.name} onClick={() => onViewClass(item.name)} className="bg-slate-800 p-5 rounded-xl border border-slate-700 shadow-lg cursor-pointer hover:border-slate-400 transition-all">
                                <div className={`p-2 w-10 h-10 rounded-lg bg-${item.color}-500/20 text-${item.color}-500 mb-3`}>{item.icon}</div>
                                <h3 className="font-bold text-white text-lg">{item.name}</h3>
                                <p className="text-slate-400 text-sm mt-1">{item.desc}</p>
                            </div>
                        ))}
                    </div>
                    <div className="flex flex-wrap justify-center gap-4 mb-6">
                        <a
                            href="https://www.youtube.com/@bandonplay"
                            target="_blank"
                            rel="noopener noreferrer"
                            className="inline-flex items-center gap-2 px-5 py-2.5 bg-amber-600/10 hover:bg-amber-600/20 text-amber-500 rounded-xl text-base font-black tracking-wider transition-all border border-amber-500/30 group shadow-lg hover:shadow-amber-500/10"
                        >
                            <span className="w-2 h-2 bg-amber-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(245,158,11,0.8)]"></span>
                            è³‡æ–™æ•´ç†è£½ä½œï¼šç·¨è‘£ä¸é›·
                            <ExternalLinkIcon size={18} className="group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform" />
                        </a>
                        <a
                            href="https://bandon1016.github.io/8-anniv-class-change/"
                            target="_blank"
                            rel="noopener noreferrer"
                            className="inline-flex items-center gap-2 px-5 py-2.5 bg-indigo-600/10 hover:bg-indigo-600/20 text-indigo-400 rounded-xl text-base font-black tracking-wider transition-all border border-indigo-500/30 group shadow-lg hover:shadow-indigo-500/10"
                        >
                            <span className="w-2 h-2 bg-indigo-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(99,102,241,0.8)]"></span>
                            8å‘¨å¹´4è·æ¥­è½‰è·å»ºè­°&å·¥å…·
                            <ExternalLinkIcon size={18} className="group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform" />
                        </a>
                    </div>

                    <div className="bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-2xl">
                        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-end mb-6 gap-4">
                            <div>
                                <h3 className="text-xl font-bold text-white flex items-center gap-2">
                                    <ActivityIcon size={24} className="text-amber-500" />
                                    {isMageActive ? 'æ³•å¸«å°ˆå±¬æ•ˆç‡åˆ†æ (å‚·å®³ vs SP)' : 'å…¨è·æ¥­æ•ˆç‡è½é»åˆ†æ (100ç­†è³‡æ–™)'}
                                </h3>
                                <div className="text-slate-400 text-sm mt-1">
                                    {isMageActive ?
                                        <p>é›™è»¸æ¯”è¼ƒï¼š<span className="text-slate-300 font-bold">â— å‚·å®³(å·¦è»¸)</span> èˆ‡ <span className="text-pink-400 font-bold">â—† SP(å³è»¸)</span> å°æ™‚é–“çš„å½±éŸ¿</p> :
                                        <>
                                            <p>å€å¡Šèªªæ˜ï¼š<span className="text-green-400 font-bold">â— æ¥µé€Ÿå€(&lt;15åˆ†)</span> / <span className="text-yellow-400 font-bold">â— ç©©å®šå€(15-30åˆ†)</span> / <span className="text-red-400 font-bold">â— è‹¦æˆ°å€(&gt;30åˆ†)</span></p>
                                            <p className="text-slate-500 text-xs mt-1">å½¢ç‹€èªªæ˜ï¼šâ–² = é‡‘è®Š/é’è®Š(é«˜æˆæœ¬) | â— = ç´«è®Š(ä¸­æˆæœ¬)</p>
                                        </>
                                    }
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setShowTrendLines(!showTrendLines)} className={`flex items-center gap-1 px-3 py-1.5 ${showTrendLines ? 'bg-amber-600 hover:bg-amber-500' : 'bg-slate-700 hover:bg-slate-600'} text-white rounded-lg text-sm transition-colors border ${showTrendLines ? 'border-amber-500' : 'border-slate-600'}`}>
                                    <TrendingUpIcon size={16} /> {showTrendLines ? 'éš±è—è¶¨å‹¢ç·š' : 'é¡¯ç¤ºè¶¨å‹¢ç·š'}
                                </button>
                            </div>
                        </div >

                        <div className="h-[450px] w-full relative select-none">
                            {/* --- æ»‘é¼ æ¸¸æ¨™ä½ç½®æ•¸å€¼é¡¯ç¤º (Floating Label) --- */}
                            {hoverPos && (
                                <div className="absolute top-2 left-1/2 -translate-x-1/2 bg-slate-900/90 border border-slate-700 px-4 py-2 rounded-full shadow-2xl text-sm flex gap-6 z-50 pointer-events-none backdrop-blur-md border-amber-500/30 ring-1 ring-white/10 animate-fade-in">
                                    <div className="flex items-center gap-2">
                                        <SwordIcon size={14} className="text-slate-400" />
                                        <span className="text-slate-400 text-xs">ç›®å‰ä½ç½®å‚·å®³ï¼š</span>
                                        <span className="text-white font-mono font-bold text-base">{Math.round(isMageActive ? hoverPos.y : hoverPos.x)}</span>
                                    </div>
                                    <div className="h-4 w-px bg-slate-700 my-auto"></div>
                                    <div className="flex items-center gap-2">
                                        <ActivityIcon size={14} className="text-amber-500" />
                                        <span className="text-slate-400 text-xs">ç›®å‰ä½ç½®æ™‚é–“ï¼š</span>
                                        <span className="text-amber-400 font-mono font-bold text-base">{Math.round(isMageActive ? hoverPos.x : hoverPos.y)} åˆ†</span>
                                    </div>
                                </div>
                            )}

                            <ResponsiveContainer width="100%" height="100%">
                                <ScatterChart
                                    margin={{ top: 20, right: 30, bottom: 30, left: 10 }}
                                    onMouseMove={(e) => {
                                        if (e && e.chartX !== undefined) {
                                            const xId = isMageActive ? "time" : "damage";
                                            const yId = isMageActive ? "left" : 0;
                                            const xAxis = e.xAxisMap ? e.xAxisMap[xId] || Object.values(e.xAxisMap)[0] : null;
                                            const yAxis = e.yAxisMap ? e.yAxisMap[yId] || Object.values(e.yAxisMap)[0] : null;
                                            if (xAxis && yAxis && xAxis.scale && yAxis.scale) {
                                                setHoverPos({ x: xAxis.scale.invert(e.chartX), y: yAxis.scale.invert(e.chartY) });
                                            }
                                        }
                                    }}
                                    onMouseLeave={() => setHoverPos(null)}
                                >
                                    <CartesianGrid strokeDasharray="3 3" stroke="#334155" />

                                    {/* --- åå­—æº–æ˜Ÿç·š --- */}
                                    {hoverPos && (
                                        <ReferenceLine
                                            xAxisId={isMageActive ? "time" : "damage"}
                                            x={hoverPos.x}
                                            stroke="#475569"
                                            strokeDasharray="3 3"
                                            isFront
                                        />
                                    )}
                                    {hoverPos && (
                                        <ReferenceLine
                                            yAxisId={isMageActive ? "left" : undefined}
                                            y={hoverPos.y}
                                            stroke="#475569"
                                            strokeDasharray="3 3"
                                            isFront
                                        />
                                    )}

                                    {/* --- åæ¨™è»¸é…ç½® --- */}
                                    {isMageActive && (
                                        <XAxis
                                            xAxisId="time"
                                            allowDataOverflow
                                            dataKey="time"
                                            name="æ™‚é–“"
                                            type="number"
                                            stroke="#94a3b8"
                                            label={{ value: 'é€šé—œæ™‚é–“ (åˆ†)', position: 'bottom', fill: '#94a3b8', dy: 10 }}
                                            domain={[0, chartBounds.yMax]}
                                        />
                                    )}
                                    {!isMageActive && (
                                        <XAxis
                                            xAxisId="damage"
                                            allowDataOverflow
                                            dataKey="damage"
                                            name="å‚·å®³"
                                            type="number"
                                            domain={[chartBounds.xMin, chartBounds.xMax]}
                                            stroke="#94a3b8"
                                            label={{ value: 'é¢æ¿å‚·å®³ (Damage)', position: 'bottom', fill: '#94a3b8', dy: 10 }}
                                        />
                                    )}

                                    {isMageActive && (
                                        <YAxis
                                            yAxisId="left"
                                            dataKey="damage"
                                            name="å‚·å®³"
                                            type="number"
                                            stroke="#8B5CF6"
                                            label={{ value: 'é¢æ¿å‚·å®³', angle: -90, position: 'insideLeft', fill: '#8B5CF6' }}
                                            domain={[chartBounds.xMin, chartBounds.xMax]}
                                        />
                                    )}
                                    {isMageActive && (
                                        <YAxis
                                            yAxisId="right"
                                            dataKey="sp"
                                            name="SP"
                                            type="number"
                                            orientation="right"
                                            stroke="#ec4899"
                                            label={{ value: 'SP (é­”æ”»)', angle: 90, position: 'insideRight', fill: '#ec4899' }}
                                            domain={[chartBounds.spMin, chartBounds.spMax]}
                                        />
                                    )}
                                    {!isMageActive && (
                                        <YAxis
                                            dataKey="time"
                                            name="æ™‚é–“"
                                            type="number"
                                            domain={[0, chartBounds.yMax]}
                                            stroke="#94a3b8"
                                            label={{ value: 'é€šé—œæ™‚é–“ (åˆ†)', angle: -90, position: 'insideLeft', fill: '#94a3b8' }}
                                        />
                                    )}

                                    {/* --- åƒè€ƒå€åŸŸ (èƒŒæ™¯è‰²å¡Š) --- */}
                                    {!isMageActive && <ReferenceArea xAxisId="damage" y1={0} y2={15} fill="#22c55e" fillOpacity={0.15} stroke="none" ifOverflow="extend" />}
                                    {!isMageActive && <ReferenceArea xAxisId="damage" y1={15} y2={30} fill="#eab308" fillOpacity={0.1} stroke="none" ifOverflow="extend" />}
                                    {!isMageActive && <ReferenceArea xAxisId="damage" y1={30} y2={300} fill="#ef4444" fillOpacity={0.15} stroke="none" ifOverflow="extend" />}

                                    {isMageActive && <ReferenceArea xAxisId="time" yAxisId="left" x1={0} x2={15} fill="#22c55e" fillOpacity={0.15} stroke="none" ifOverflow="extend" />}
                                    {isMageActive && <ReferenceArea xAxisId="time" yAxisId="left" x1={15} x2={30} fill="#eab308" fillOpacity={0.1} stroke="none" ifOverflow="extend" />}
                                    {isMageActive && <ReferenceArea xAxisId="time" yAxisId="left" x1={30} x2={300} fill="#ef4444" fillOpacity={0.15} stroke="none" ifOverflow="extend" />}

                                    <Tooltip cursor={{ strokeDasharray: '3 3' }} content={({ active, payload }) => {
                                        if (active && payload && payload.length) {
                                            const d = payload[0].payload;
                                            if (!d.class) return null;
                                            const isSPDot = d.isSPData;
                                            return (
                                                <div className="bg-slate-900 border border-slate-600 p-4 rounded-lg shadow-2xl text-sm min-w-[180px] z-50">
                                                    <p className="font-bold text-lg mb-2" style={{ color: isSPDot ? '#ec4899' : COLORS[d.class] }}>
                                                        {d.class} Lv.{d.level} {isSPDot ? '(SPæ•¸æ“š)' : ''}
                                                    </p>
                                                    <div className="space-y-1 text-slate-300">
                                                        <p>é€šé—œæ™‚é–“ï¼š<span className="text-amber-400 font-bold">{d.time === 0 ? 'å¤±æ•—' : d.time + ' åˆ†'}</span></p>
                                                        <p>å‚·å®³ï¼š<span className="text-white font-bold">{d.damage}</span></p>
                                                        {d.sp && <p>SPï¼š<span className="text-pink-400 font-bold">{d.sp}</span></p>}
                                                        <p>è®Šèº«ï¼š<span className="text-slate-300">{d.trans}</span></p>
                                                        <p className="text-xs text-slate-500 pt-2 border-t border-slate-700 mt-2">{d.skill}</p>
                                                        {d.note && <p className="text-xs text-blue-400 italic">"{d.note}"</p>}
                                                    </div>
                                                </div>
                                            );
                                        }
                                        return null;
                                    }} />

                                    {isMageActive && <Legend verticalAlign="top" height={36} />}

                                    {/* --- 1. æ³•å¸«æ¨¡å¼ç‰¹æ®Šæ¸²æŸ“ (é›™Yè»¸) --- */}
                                    {isMageActive && (
                                        <Scatter
                                            name="é¢æ¿å‚·å®³"
                                            data={FULL_DATA.filter(d => d.class === 'æ³•å¸«' && d.time > 0)}
                                            fill={COLORS['æ³•å¸«']}
                                            xAxisId="time"
                                            yAxisId="left"
                                            shape="circle"
                                        />
                                    )}
                                    {isMageActive && (
                                        <Scatter
                                            name="SP (é­”æ”»)"
                                            data={FULL_DATA.filter(d => d.class === 'æ³•å¸«' && d.time > 0 && d.sp)}
                                            fill="#ec4899"
                                            xAxisId="time"
                                            yAxisId="right"
                                            shape="diamond"
                                        />
                                    )}
                                    {isMageActive && showTrendLines && mageTrendLines && mageTrendLines.damageTrend && (
                                        <Scatter
                                            name="å‚·å®³è¶¨å‹¢"
                                            data={[
                                                { time: mageTrendLines.damageTrend.startPoint.x, damage: mageTrendLines.damageTrend.startPoint.y },
                                                { time: mageTrendLines.damageTrend.endPoint.x, damage: mageTrendLines.damageTrend.endPoint.y }
                                            ]}
                                            fill="none"
                                            line={{ stroke: COLORS['æ³•å¸«'], strokeWidth: 3, strokeDasharray: '8 4' }}
                                            lineType="joint"
                                            legendType="none"
                                            xAxisId="time"
                                            yAxisId="left"
                                            shape={() => null}
                                        />
                                    )}
                                    {isMageActive && showTrendLines && mageTrendLines && mageTrendLines.spTrend && (
                                        <Scatter
                                            name="SPè¶¨å‹¢"
                                            data={[
                                                { time: mageTrendLines.spTrend.startPoint.x, sp: mageTrendLines.spTrend.startPoint.y },
                                                { time: mageTrendLines.spTrend.endPoint.x, sp: mageTrendLines.spTrend.endPoint.y }
                                            ]}
                                            fill="none"
                                            line={{ stroke: '#ec4899', strokeWidth: 3, strokeDasharray: '8 4' }}
                                            lineType="joint"
                                            legendType="none"
                                            xAxisId="time"
                                            yAxisId="right"
                                            shape={() => null}
                                        />
                                    )}

                                    {/* --- 2. å…¶ä»–è·æ¥­æ¨¡å¼æ¸²æŸ“ --- */}
                                    {!isMageActive && ALL_CLASSES.map(job => {
                                        if (activeJob && activeJob !== job) return null;
                                        const jobData = FULL_DATA.filter(d => d.class === job && d.time > 0);
                                        return (
                                            <Scatter
                                                key={job}
                                                name={job}
                                                data={jobData}
                                                fill={COLORS[job]}
                                                fillOpacity={0.9}
                                                stroke="#fff"
                                                strokeWidth={1}
                                                shape={<CustomShape />}
                                                xAxisId="damage"
                                            />
                                        );
                                    })}

                                    {/* --- 3. å…¶ä»–è·æ¥­è¶¨å‹¢ç·š --- */}
                                    {!isMageActive && showTrendLines && ALL_CLASSES.map(job => {
                                        if (activeJob && activeJob !== job) return null;
                                        const trend = trendLines[job];
                                        if (!trend) return null;
                                        return (
                                            <Scatter
                                                key={`trend-${job}`}
                                                name={`${job}è¶¨å‹¢`}
                                                data={[
                                                    { damage: trend.startPoint.x, time: Math.max(0, trend.startPoint.y) },
                                                    { damage: trend.endPoint.x, time: Math.max(0, trend.endPoint.y) }
                                                ]}
                                                fill="none"
                                                line={{ stroke: COLORS[job], strokeWidth: 2, strokeDasharray: '8 4' }}
                                                lineType="joint"
                                                legendType="none"
                                                xAxisId="damage"
                                                shape={() => null}
                                            />
                                        );
                                    })}



                                </ScatterChart>
                            </ResponsiveContainer>
                            <div className="absolute inset-0 flex items-center justify-center pointer-events-none opacity-5"><span className="text-9xl font-black text-white">ç·¨è‘£ä¸é›·</span></div>
                        </div>

                        <div className="mt-8 flex flex-wrap justify-center gap-2">
                            {ALL_CLASSES.map(job => (
                                <button key={job} onClick={() => setActiveJob(activeJob === job ? null : job)} className={`px-3 py-1.5 rounded-full text-sm font-bold transition-all border ${activeJob === job ? 'bg-slate-600 border-white text-white scale-110 shadow-lg' : 'bg-slate-900/50 border-slate-700 text-slate-400 hover:bg-slate-700'}`}>
                                    <span className="inline-block w-2.5 h-2.5 rounded-full mr-2" style={{ backgroundColor: COLORS[job] }} />{job}
                                </button>
                            ))}
                        </div>

                        <div className="mt-12 grid grid-cols-1 md:grid-cols-2 gap-6 border-t border-slate-700 pt-8">
                            <div className="bg-slate-800/50 p-6 rounded-xl border border-slate-700/50">
                                <h4 className="text-lg font-bold text-white mb-3 flex items-center gap-2">
                                    <ZapIcon className="text-yellow-400" /> 1. é‡è¦å±¬æ€§
                                </h4>
                                <p className="text-slate-300 text-sm leading-relaxed">
                                    åœ°é¾æ‡¼æ€•åœ°å±¬æ€§ï¼Œé‡å°åœ°å±¬æ€§å‚·å®³ã€å±¬æ€§çˆ†æ“ŠåŠ å¼·å¯æ˜é¡¯æé«˜å‚·å®³ã€‚å¦å¤–ï¼Œæ§æ‰‹ã€å¦–ç²¾ä¹Ÿè¦ä½¿ç”¨æœ‰"è²«é€š"æ•ˆæœçš„æ­¦å™¨æ‰ä¸è‡³å°è‡´å‚·å®³æ¸›åŠã€‚
                                </p>
                            </div>
                            <div className="bg-slate-800/50 p-6 rounded-xl border border-slate-700/50">
                                <h4 className="text-lg font-bold text-white mb-3 flex items-center gap-2">
                                    <TrendingUpIcon className="text-blue-400" /> 2. æ”»æ“Šé€Ÿåº¦
                                </h4>
                                <p className="text-slate-300 text-sm leading-relaxed">
                                    è®Šèº«æ”»é€Ÿç›´æ¥å½±éŸ¿æ•ˆç‡ï¼Œèƒ½è¦ºé†’ç›¡é‡æ‹šï¼Œæ”¶è—æˆ–èƒ½æé«˜æ”»é€Ÿçš„é£¾å“(å¦‚ï¼šé¢¨é¾æ°´æ™¶)ä¹Ÿèƒ½å¼·åŒ–æˆ–æ›ä¸Šã€‚
                                </p>
                            </div>
                            <div className="bg-slate-800/50 p-6 rounded-xl border border-slate-700/50">
                                <h4 className="text-lg font-bold text-white mb-3 flex items-center gap-2">
                                    <TargetIcon className="text-red-400" /> 3. é—œéµæŠ€èƒ½
                                </h4>
                                <p className="text-slate-300 text-sm leading-relaxed">
                                    æ¯å€‹è·æ¥­éƒ½æœ‰å½±éŸ¿å‚·å®³çš„é—œéµç´…ç´«æŠ€ï¼Œæ¯”å¦‚ç‹æ—çš„å‹‡çŒ›(å¤§å¸«)ã€é›·ç¥çš„æ¥µé™é©…å‹•...ç­‰ç­‰ï¼Œæœé€™é¡æŠ€èƒ½è‘—æ‰‹èƒ½å¤§å¹…æå‡æ•ˆç‡ã€‚
                                </p>
                            </div>
                            <div className="bg-slate-800/50 p-6 rounded-xl border border-slate-700/50">
                                <h4 className="text-lg font-bold text-white mb-3 flex items-center gap-2">
                                    <AlertIcon className="text-amber-400" /> 4. è·æ¥­æŒ‘é¸
                                </h4>
                                <p className="text-slate-300 text-sm leading-relaxed">
                                    ä¸Šé¢æ¥µå°‘æ•¸æä¾›æ•¸æ“šçš„è·æ¥­ï¼Œä¸è¦çŒ¶è±«ï¼é¿é–‹å°±å°äº†ï¼é¸å°è·æ¥­å°‘åŠªåŠ›20å¹´ã€‚
                                </p>
                            </div>
                        </div>

                        {/* è¶¨å‹¢ç·šèˆ‡æ€§åƒ¹æ¯”è§£é‡‹å€å¡Š */}
                        {
                            showTrendLines && (
                                <div className="mt-8 bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-xl border border-amber-500/30 shadow-xl">
                                    <h4 className="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                        <TrendingUpIcon className="text-amber-500" /> è¶¨å‹¢ç·šèˆ‡æ€§åƒ¹æ¯”åˆ†æ
                                    </h4>

                                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                        <div className="bg-slate-900/50 p-4 rounded-lg border-l-4 border-green-500">
                                            <h5 className="text-green-400 font-bold mb-2">ğŸ“ˆ è¶¨å‹¢ç·šè§£è®€</h5>
                                            <ul className="text-slate-300 text-sm space-y-2">
                                                <li>â€¢ <span className="text-white font-bold">è¶¨å‹¢ç·šä½ç½®è¶Šä½</span>ï¼šè©²è·æ¥­åœ¨ç›¸åŒå‚·å®³ä¸‹ï¼Œé€šé—œæ™‚é–“è¶ŠçŸ­ï¼Œ<span className="text-green-400">æ€§åƒ¹æ¯”è¶Šé«˜</span></li>
                                                <li>â€¢ <span className="text-white font-bold">è¶¨å‹¢ç·šæ–œç‡è¶Šé™¡ï¼ˆå‘ä¸‹ï¼‰</span>ï¼šæ¯å¢åŠ ä¸€é»å‚·å®³ï¼Œæ™‚é–“æ¸›å°‘è¶Šå¤šï¼Œ<span className="text-green-400">æŠ•è³‡å›å ±ç‡è¶Šé«˜</span></li>
                                                <li>â€¢ <span className="text-white font-bold">è¶¨å‹¢ç·šè¶Šå¹³</span>ï¼šå‚·å®³å°æ™‚é–“å½±éŸ¿è¼ƒå°ï¼Œå¯èƒ½éœ€è¦ä¾è³´æŠ€èƒ½æˆ–å…¶ä»–å› ç´ </li>
                                            </ul>
                                        </div>

                                        <div className="bg-slate-900/50 p-4 rounded-lg border-l-4 border-amber-500">
                                            <h5 className="text-amber-400 font-bold mb-2">ğŸ’¡ æ€§åƒ¹æ¯”æŒ‡æ¨™</h5>
                                            <ul className="text-slate-300 text-sm space-y-2">
                                                <li>â€¢ <span className="text-white font-bold">é«˜æ€§åƒ¹æ¯”è·æ¥­</span>ï¼šè¶¨å‹¢ç·šåœ¨ã€Œæ¥µé€Ÿå€ã€ï¼ˆç¶ è‰²å€åŸŸï¼‰ç©¿éï¼Œä»£è¡¨ä½æŠ•å…¥é«˜å›å ±</li>
                                                <li>â€¢ <span className="text-white font-bold">ç©©å®šå‹è·æ¥­</span>ï¼šè¶¨å‹¢ç·šæ–œç‡ç©©å®šï¼Œç„¡è«–å‚·å®³é«˜ä½éƒ½èƒ½å®Œæˆé€šé—œ</li>
                                                <li>â€¢ <span className="text-white font-bold">é–€æª»å‹è·æ¥­</span>ï¼šè¶¨å‹¢ç·šé›¢æ•£åº¦é«˜ï¼Œè¡¨ç¤ºéœ€è¦ç‰¹å®šæ¢ä»¶æ‰èƒ½ç™¼æ®æ•ˆç‡</li>
                                            </ul>
                                        </div>
                                    </div>

                                    {/* å„è·æ¥­è¶¨å‹¢ç·šæ•¸æ“šè¡¨ */}
                                    <div className="overflow-x-auto">
                                        <h5 className="text-slate-300 font-bold mb-3">ğŸ“Š å„è·æ¥­æ•ˆç‡æŒ‡æ¨™æ’å</h5>
                                        <table className="w-full text-sm">
                                            <thead className="bg-slate-900 text-slate-400">
                                                <tr>
                                                    <th className="px-3 py-2 text-left">è·æ¥­</th>
                                                    <th className="px-3 py-2 text-center">æ¨£æœ¬æ•¸</th>
                                                    <th className="px-3 py-2 text-center">æ•ˆç‡æŒ‡æ¨™</th>
                                                    <th className="px-3 py-2 text-center">RÂ²</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-700">
                                                {Object.entries(trendLines)
                                                    .sort((a, b) => b[1].rSquared - a[1].rSquared)
                                                    .map(([job, trend]) => {
                                                        const jobData = FULL_DATA.filter(d => d.class === job && d.time > 0);
                                                        const efficiencyLevel = trend.efficiency > 0.15 ? 'text-green-400' :
                                                            trend.efficiency > 0.08 ? 'text-yellow-400' : 'text-red-400';
                                                        return (
                                                            <tr key={job} className="hover:bg-slate-700/50">
                                                                <td className="px-3 py-2">
                                                                    <span className="inline-block w-3 h-3 rounded-full mr-2" style={{ backgroundColor: COLORS[job] }}></span>
                                                                    <span className="font-bold" style={{ color: COLORS[job] }}>{job}</span>
                                                                </td>
                                                                <td className="px-3 py-2 text-center text-slate-400">{jobData.length}</td>
                                                                <td className={`px-3 py-2 text-center font-bold ${efficiencyLevel}`}>
                                                                    {trend.efficiency.toFixed(2)} åˆ†/100å‚·
                                                                </td>
                                                                <td className="px-3 py-2 text-center text-slate-400">
                                                                    {(trend.rSquared * 100).toFixed(0)}%
                                                                </td>
                                                            </tr>
                                                        );
                                                    })}
                                            </tbody>
                                        </table>
                                        <p className="text-slate-500 text-xs mt-2">
                                            * æ•ˆç‡æŒ‡æ¨™ = æ¯å¢åŠ 100é»å‚·å®³å¯æ¸›å°‘çš„é€šé—œæ™‚é–“ï¼ˆåˆ†é˜ï¼‰| RÂ² = è¶¨å‹¢ç·šæ“¬åˆåº¦ï¼ˆè¶Šé«˜è¡¨ç¤ºæ•¸æ“šè¶Šç¬¦åˆç·šæ€§é—œä¿‚ï¼‰
                                        </p>
                                    </div>
                                </div>
                            )
                        }

                    </div >
                </div >
            );
        };

        const ClassDetail = ({ className, onBack }) => {
            const data = useMemo(() => FULL_DATA.filter(d => d.class === className).sort((a, b) => a.damage - b.damage), [className]);
            const best = [...data].filter(d => d.time > 0).sort((a, b) => a.time - b.time)[0];
            const worst = [...data].filter(d => d.time > 0).sort((a, b) => b.time - a.time)[0];

            const getTimeColor = (time, bestTime, worstTime) => {
                if (time === 0) return 'text-red-600 font-black';
                if (time === bestTime) return 'text-green-400 font-black scale-110 inline-block drop-shadow-[0_0_8px_rgba(74,222,128,0.5)]';
                if (time === worstTime) return 'text-red-400 font-bold';
                if (time <= 15) return 'text-green-400 font-bold';
                if (time >= 40) return 'text-red-400 font-bold';
                return 'text-white font-medium';
            };

            const getAnalysis = () => {
                switch (className) {
                    case 'æ³•å¸«': return {
                        verdict: 'Special Tier',
                        summary: 'æŠ€èƒ½é–€æª»æ¥µé«˜ã€‚ä¸èƒ½å–®ç´”ç”¨é¢æ¿å‚·å®³ä¾†è¡¡é‡ï¼Œå¿…é ˆå…·å‚™ã€Œå¤ä»£ç©¶å…‰ã€ç­‰æ ¸å¿ƒæŠ€èƒ½æ‰èƒ½æ‰“å‡ºé«˜æ•ˆæˆç¸¾ã€‚',
                        key: 'æŠ€èƒ½å®Œæ•´åº¦æ±ºå®šä¸€åˆ‡ã€‚æ³•å¸«çš„æ©Ÿåˆ¶ç‰¹æ®Šï¼Œç„¡æ³•ç›´æ¥èˆ‡å…¶ä»–è·æ¥­é€éé¢æ¿å‚·å®³é€²è¡Œæ©«å‘æ¯”è¼ƒã€‚',
                        trap: 'æ²’æœ‰è¶³å¤ çš„é—œéµæŠ€èƒ½ï¼ˆå¦‚ç©¶å…‰ï¼‰èˆ‡å›é­”æ”¯æ’ï¼Œåƒè¬ä¸è¦è²¿ç„¶æŒ‘æˆ°ã€‚'
                    };
                    case 'é­”åŠå£«': return {
                        verdict: 'C Tier',
                        summary: 'ä¸­è·é›¢æ”»æ“Šè·æ¥­ã€‚æ•¸æ“šé¡¯ç¤ºæ¥µç«¯è½å·®ï¼š260å‚·å®³ç™½æŠ€æ‰“55åˆ†ï¼Œç´…æŠ€æ‰“27åˆ†ã€‚æ™®æ”»ä¿‚æ•¸ä½ã€‚',
                        key: 'å‚·å®³å®Œå…¨ä¾†è‡ªæŠ€èƒ½å †ç–Šã€‚',
                        trap: 'é›–ç‚ºä¸­è·é›¢ï¼Œä½†æ²’ç´…æŠ€é€²å ´å°±æ˜¯åç‰¢ï¼Œåƒè¬åˆ¥ç”¨ç™½æŠ€æ‰“ã€‚'
                    };
                    case 'é¾é¬¥': return {
                        verdict: 'B- Tier',
                        summary: 'ä¸­è·é›¢æ”»æ“Šè·æ¥­ã€‚è¡¨ç¾ä¸ç©©ï¼Œæœ‰é›™é‡‘æŠ€æ‰“42åˆ†çš„æ¡ˆä¾‹ï¼Œä¹Ÿæœ‰9åˆ†é˜çš„æ¥µé€Ÿç´€éŒ„ã€‚',
                        key: 'å¼±é»æ›å…‰ç–ŠåŠ çš„ç©©å®šæ€§ã€‚',
                        trap: 'æ“ä½œä¸Šä¸‹é™å·®è·æ¥µå¤§ï¼Œéœ€é•·æ™‚é–“æš–æ©Ÿã€‚'
                    };
                    case 'æ­»ç¥': return {
                        verdict: 'A Tier',
                        summary: 'ä¸­è·é›¢æ”»æ“Šè·æ¥­ã€‚æ•¸æ“šé¡¯ç¤ºé«˜å‚·(345)ä¸‹æ•ˆç‡æ¥µä½³(13åˆ†)ï¼Œè¼¸å‡ºç¯€å¥æ˜å¿«ã€‚',
                        key: 'æŠ€èƒ½å…¨æ»¿èˆ‡å•†åŸç´«æŠ€çš„åŠ æŒã€‚',
                        trap: 'ç›®å‰æ¨£æœ¬å¤šç‚ºé ‚è¦æ©Ÿé«”ï¼Œä¸­ä½éšæ©Ÿé«”è¡¨ç¾å¾…é©—è­‰ã€‚'
                    };
                    case 'æ§æ‰‹': return { verdict: 'S Tier', summary: 'CPå€¼ç‹è€…ã€‚æ•¸æ“šé©—è­‰ï¼š194å‚·å®³ç´«è®Š(15åˆ†)å®Œå‹250å‚·å®³é‡‘è®Š(30åˆ†)ã€‚', key: 'ç´…ç´«æŠ€å®Œæ•´åº¦ > è®Šèº«é¡è‰²ã€‚æ”»æ“ŠæŠ€èƒ½å®Œæ•´æ€§å¿…é ˆè¦æ’é«˜ã€‚', trap: '87ç­‰é‡‘è®Šæ¡ˆä¾‹é¡¯ç¤ºï¼Œç­‰ç´šèˆ‡æŠ€èƒ½è‹¥ä¸å…¨ï¼Œé‡‘è®Šä¹Ÿæ•‘ä¸äº†ã€‚' };
                    case 'é›·ç¥': return { verdict: 'A Tier', summary: 'ä¸‹é™æ¥µé«˜ã€‚å³ä½¿åªæœ‰ 196 å‚·å®³ä¹Ÿèƒ½ç£¨æ­»åœ°é¾ (30åˆ†)ã€‚', key: 'è¡€ç›Ÿç¨ç‰¹ç´«æŠ€ã€Œæ¥µé™é©…å‹•ã€æä¾›äº†ç©©å®šçš„è¢«å‹•è¼¸å‡ºã€‚', trap: 'ç„¡æ˜é¡¯é™·é˜±ï¼Œè€å¿ƒç£¨å¿…éï¼Œæ¥µé™é©…å‹•ï¼Œæ½›èƒ½ç„¡é™ã€‚' };
                    case 'ç‹æ—': return { verdict: 'Budget King', summary: 'åªéœ€å…©æœ¬ç´…æŠ€(å‹‡çŒ›æ„å¿—+å¤§å¸«)å³å¯ç©©å®šé€šé—œï¼Œé¤Šæˆæˆæœ¬æœ€ä½ã€‚', key: 'ã€Œå‹‡çŒ›æ„å¿—ã€æä¾›ç©©å®šæ”»é€Ÿï¼Œç„¡éœ€ä»»ä½•ç´«æŠ€ä¹Ÿèƒ½å–®æŒ‘ã€‚', trap: 'éœ€æœ‰è€å¿ƒï¼Œæ‰“å¾—æ…¢ä¸æ˜¯æ‰“ä¸éã€‚' };
                    case 'é»‘å¦–': return { verdict: 'Risk Tier', summary: 'æ¥µé€Ÿå‚³èªª (8åˆ†é˜)ï¼Œä½†ç”Ÿå­˜å£“åŠ›å·¨å¤§ã€‚', key: 'ã€Œå¤¢é­˜ã€ç”Ÿå­˜æŠ€èˆ‡ã€Œç ´å£ç›”ç”²ã€çˆ†ç™¼æŠ€ç¼ºä¸€ä¸å¯ã€‚', trap: 'æ©Ÿé«”ä¸å¤ ç¡¬ä¸”æ²’å¤¢é­˜ï¼Œé€²å ´å³æ­»äº¡ã€‚' };
                    case 'é¨å£«': return { verdict: 'Odd Tier', summary: 'åç›´è¦ºï¼š300å‚·ç´«è®Šéœ€45åˆ†ï¼Œ230å‚·é‡‘è®Šåƒ…éœ€27åˆ†ã€‚', key: 'é‡‘æŠ€/è¦ºé†’æ•ˆæœå¯èƒ½é å¤§æ–¼é¢æ¿å‚·å®³ã€‚', trap: 'é«˜å‚·ç´«è®Šæ•ˆç‡æ¥µä½ï¼Œéœ€ç‰¹åˆ¥æ³¨æ„æŠ€èƒ½é…ç½®ã€‚' };
                    case 'æš—é¨': return { verdict: 'B Tier', summary: 'æ¨£æœ¬è¼ƒå°‘ï¼Œç›®å‰ 238 å‚·å®³éœ€ 45 åˆ†ï¼Œæ•ˆç‡ä¸­ä¸‹ã€‚', key: 'éœ€æ›´å¤šé«˜éšæ©Ÿé«”æ•¸æ“šé©—è­‰ã€‚', trap: 'ç›®å‰æ•¸æ“šé¡¯ç¤ºä½å‚·æ•ˆç‡ä¸ä½³ã€‚' };
                    default: return { verdict: 'æ¨™æº–å‹', summary: 'æ•ˆç‡éš¨å‚·å®³ç·šæ€§æå‡ã€‚', key: 'ç´…ç´«æŠ€å®Œæ•´åº¦ã€‚', trap: 'é«˜å‚·å®³è‹¥é…ç™½æŠ€æ•ˆç‡ä¾ç„¶ä½è½ã€‚' };
                }
            };
            const analysis = getAnalysis();

            return (
                <div className="space-y-6 animate-fade-in pb-12">
                    <button onClick={onBack} className="flex items-center text-slate-400 hover:text-white gap-1 group transition-colors"><BackIcon size={18} className="group-hover:-translate-x-1 transition-transform" />è¿”å›ç¸½è¦½</button>

                    <div className="bg-slate-800 rounded-xl p-8 border border-slate-700 shadow-xl">
                        <div className="flex flex-col md:flex-row justify-between gap-6 mb-8">
                            <div>
                                <h2 className="text-4xl font-black text-white" style={{ color: COLORS[className] }}>{className}</h2>
                                <div className="mt-3 flex gap-3"><span className="px-3 py-1 bg-slate-700 rounded-full text-sm font-bold border border-slate-600">{analysis.verdict}</span></div>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 flex-1">
                                <div className="bg-slate-900/50 p-4 rounded-lg border-l-4 border-blue-500">
                                    <h4 className="text-blue-400 font-bold mb-1 flex items-center gap-2"><InfoIcon size={16} />æ•¸æ“šç¸½çµ</h4>
                                    <p className="text-slate-300 text-sm">{analysis.summary}</p>
                                </div>
                                <div className="bg-slate-900/50 p-4 rounded-lg border-l-4 border-amber-500">
                                    <h4 className="text-amber-400 font-bold mb-1 flex items-center gap-2"><TargetIcon size={16} />é—œéµè®Šå› </h4>
                                    <p className="text-slate-300 text-sm">{analysis.key}</p>
                                </div>
                                <div className="bg-slate-900/50 p-4 rounded-lg border-l-4 border-red-500">
                                    <h4 className="text-red-400 font-bold mb-1 flex items-center gap-2"><AlertIcon size={16} />é¿å‘æŒ‡å—</h4>
                                    <p className="text-slate-300 text-sm">{analysis.trap}</p>
                                </div>
                            </div>
                        </div>

                        {best && worst && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                                <div className="bg-gradient-to-br from-green-900/30 to-slate-900 border border-green-500/30 p-6 rounded-xl shadow-lg relative overflow-hidden">
                                    <div className="absolute top-0 right-0 w-24 h-24 bg-green-500/10 rounded-full blur-2xl -mr-10 -mt-10"></div>
                                    <div className="flex items-center justify-between mb-4 border-b border-green-500/20 pb-2">
                                        <span className="text-green-400 text-sm font-bold uppercase tracking-wider flex items-center gap-2"><ZapIcon size={16} /> æœ€é«˜æ•ˆç‡ (Best Run)</span>
                                        <span className="text-3xl font-black text-white">{best.time} <span className="text-sm font-normal text-slate-400">åˆ†</span></span>
                                    </div>
                                    <div className="grid grid-cols-2 gap-y-3 text-sm">
                                        <div><span className="text-slate-500 text-xs block">æ©Ÿé«”å‚·å®³</span><span className="text-white font-bold text-lg">{best.damage}</span></div>
                                        <div><span className="text-slate-500 text-xs block">è®Šèº«ç­‰ç´š</span><span className="text-white">{best.trans}</span></div>
                                        <div className="col-span-2"><span className="text-slate-500 text-xs block">æŠ€èƒ½é…ç½®</span><span className="text-slate-300">{best.skill}</span></div>
                                        <div className="col-span-2"><span className="text-slate-500 text-xs block">é—œéµå‚™è¨»</span><span className="text-green-300">{best.note || 'ç„¡'}</span></div>
                                    </div>
                                </div>

                                <div className="bg-gradient-to-br from-red-900/30 to-slate-900 border border-red-500/30 p-6 rounded-xl shadow-lg relative overflow-hidden">
                                    <div className="absolute top-0 right-0 w-24 h-24 bg-red-500/10 rounded-full blur-2xl -mr-10 -mt-10"></div>
                                    <div className="flex items-center justify-between mb-4 border-b border-red-500/20 pb-2">
                                        <span className="text-red-400 text-sm font-bold uppercase tracking-wider flex items-center gap-2"><AlertIcon size={16} /> æœ€ä½æ•ˆç‡ (Worst Run)</span>
                                        <span className="text-3xl font-black text-white">{worst.time === 0 ? 'å¤±æ•—' : worst.time} <span className="text-sm font-normal text-slate-400">{worst.time === 0 ? '' : 'åˆ†'}</span></span>
                                    </div>
                                    <div className="grid grid-cols-2 gap-y-3 text-sm">
                                        <div><span className="text-slate-500 text-xs block">æ©Ÿé«”å‚·å®³</span><span className="text-white font-bold text-lg">{worst.damage}</span></div>
                                        <div><span className="text-slate-500 text-xs block">è®Šèº«ç­‰ç´š</span><span className="text-white">{worst.trans}</span></div>
                                        <div className="col-span-2"><span className="text-slate-500 text-xs block">æŠ€èƒ½é…ç½®</span><span className="text-slate-300">{worst.skill}</span></div>
                                        <div className="col-span-2"><span className="text-slate-500 text-xs block">é—œéµå‚™è¨»</span><span className="text-red-300">{worst.note || 'ç„¡'} {className === 'é›·ç¥' ? ' æ¥µé™é©…å‹•ï¼Œæ½›èƒ½ç„¡é™' : ''}</span></div>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="overflow-x-auto rounded-xl border border-slate-700">
                            <table className="w-full text-left text-sm text-slate-300">
                                <thead className="bg-slate-900 text-xs text-slate-400 uppercase">
                                    <tr><th className="px-4 py-3">ç·¨è™Ÿ</th><th className="px-4 py-3">ç­‰ç´š</th><th className="px-4 py-3">è®Šèº«</th><th className="px-4 py-3">å‚·å®³</th><th className="px-4 py-3">æŠ€èƒ½</th><th className="px-4 py-3">å‚™è¨»</th><th className="px-4 py-3 text-right">æ™‚é–“</th></tr>
                                </thead>
                                <tbody className="divide-y divide-slate-700">
                                    {data.map(row => (
                                        <tr key={row.id} className="hover:bg-slate-700/50">
                                            <td className="px-4 py-3 text-slate-500">#{row.id}</td>
                                            <td className="px-4 py-3">{row.level}</td>
                                            <td className="px-4 py-3">{row.trans}</td>
                                            <td className="px-4 py-3 font-bold text-white">{row.damage}</td>
                                            <td className="px-4 py-3 text-xs text-slate-400 max-w-[200px] truncate" title={row.skill}>{row.skill}</td>
                                            <td className="px-4 py-3 text-xs text-slate-500 max-w-[150px] truncate" title={row.note}>{row.note}</td>
                                            <td className={`px-4 py-3 text-right font-mono ${getTimeColor(row.time, best?.time, worst?.time)}`}>
                                                {row.time === 0 ? 'å¤±æ•—' : `${row.time}m`}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('overview');
            const [selectedClass, setSelectedClass] = useState('æ§æ‰‹');
            const [isMenuOpen, setIsMenuOpen] = useState(false);

            const handleClassSelect = (job) => { setView('detail'); setSelectedClass(job); setIsMenuOpen(false); window.scrollTo(0, 0); };

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 font-sans">
                    <nav className="bg-slate-900 border-b border-slate-800 sticky top-0 z-50 shadow-xl">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('overview')}>
                                <div className="bg-gradient-to-br from-indigo-600 to-purple-700 p-2 rounded-lg shadow-lg"><ShieldIcon size={24} className="text-white" /></div>
                                <h1 className="text-lg font-bold text-white tracking-tight hidden sm:block">å¤©å ‚M åœ°é¾å–®æŒ‘<span className="text-amber-500">çµ‚æ¥µ</span>åˆ†æ</h1>
                            </div>
                            <div className="hidden md:flex gap-1 overflow-x-auto px-4 no-scrollbar">
                                <button onClick={() => setView('overview')} className={`px-3 py-2 rounded-md text-sm font-medium transition-all ${view === 'overview' ? 'text-amber-400 bg-slate-800' : 'text-slate-400 hover:text-white'}`}>ç¸½è¦½</button>
                                {ALL_CLASSES.map(job => (
                                    <button key={job} onClick={() => handleClassSelect(job)} className={`px-3 py-2 rounded-md text-sm font-medium whitespace-nowrap transition-all ${view === 'detail' && selectedClass === job ? 'text-amber-400 bg-slate-800' : 'text-slate-400 hover:text-white'}`}>{job}</button>
                                ))}
                            </div>
                            <div className="md:hidden"><button onClick={() => setIsMenuOpen(!isMenuOpen)} className="p-2 text-slate-400 hover:text-white transition-colors">{isMenuOpen ? <CloseIcon /> : <MenuIcon />}</button></div>
                        </div>
                        {isMenuOpen && (
                            <div className="md:hidden bg-slate-900 border-t border-slate-800 absolute w-full shadow-2xl z-50 p-4 grid grid-cols-3 gap-2">
                                <button onClick={() => { setView('overview'); setIsMenuOpen(false); }} className="col-span-3 py-3 bg-slate-800 rounded-lg text-amber-500 font-bold mb-2">è¿”å›ç¸½è¦½</button>
                                {ALL_CLASSES.map(job => (
                                    <button key={job} onClick={() => handleClassSelect(job)} className="py-2 bg-slate-800/50 rounded-lg text-xs text-slate-300">{job}</button>
                                ))}
                            </div>
                        )}
                    </nav>
                    <main className="max-w-7xl mx-auto px-4 py-8 min-h-screen">
                        {view === 'overview' ? <Overview onViewClass={handleClassSelect} /> : <ClassDetail className={selectedClass} onBack={() => setView('overview')} />}
                    </main>
                    <footer className="bg-slate-900 border-t border-slate-800 py-12">
                        <div className="max-w-7xl mx-auto px-4 text-center">
                            <p className="text-slate-500 text-sm">æ•¸æ“šä¾†æºï¼šæ‰€æœ‰æ•¸æ“šéšå–è‡ªç©å®¶å›å ±ï¼Œåˆ†æåƒ…ä¾›åƒè€ƒ (2025å¹´12æœˆ)</p>
                            <div className="mt-8 flex justify-center">
                                <a
                                    href="https://www.youtube.com/@bandonplay"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="inline-flex items-center gap-2 px-5 py-2.5 bg-amber-600/10 hover:bg-amber-600/20 text-amber-500 rounded-xl text-base font-black tracking-wider transition-all border border-amber-500/30 group shadow-lg hover:shadow-amber-500/10"
                                >
                                    <span className="w-2 h-2 bg-amber-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(245,158,11,0.8)]"></span>
                                    è³‡æ–™æ•´ç†è£½ä½œï¼šç·¨è‘£ä¸é›·
                                    <ExternalLinkIcon size={18} className="group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform" />
                                </a>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>


</html>
